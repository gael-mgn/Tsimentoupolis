<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex">
  <title>Tsimentoupolis - Redirection...</title>
  <script>
  (async () => {
    const userLang = navigator.language.split(/[-_]/)[0]; // "fr", "en", etc.
    const fallbackLangs = ["fr", "en", "gr"];
    const triedLangs = [userLang, ...fallbackLangs.filter(l => l !== userLang)];

    const checkExists = async (lang) => {
      try {
        const response = await fetch(`./${lang}/index.html`, { method: 'HEAD' });
        return response.ok;
      } catch {
        return false;
      }
    };

    // Récupération de l'URL d'origine
    const referrer = document.referrer ? encodeURIComponent(document.referrer) : "direct";

    for (const lang of triedLangs) {
      const exists = await checkExists(lang);
      if (exists) {
        // Ajoute ?source=... ou &source=... selon s'il y a déjà des paramètres
        const targetUrl = `./${lang}/index.html`;
        const separator = targetUrl.includes("?") ? "&" : "?";
        window.location.replace(`${targetUrl}${separator}source=${referrer}`);
        break;
      }
    }
  })();
  </script>
</head>
<body>
  <!--<p>Redirection en cours...</p>-->
</body>
</html>
